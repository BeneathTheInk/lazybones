!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Lazybones=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){}function e(a){return a&&g(a,["syncOptions","sync_options"])}function f(a){return a&&(g(a,["pouch","pouchdb","db","database"])||f(a.collection))}function g(a,b){var c,d;for(d in b){if(c=a[b[d]],"function"==typeof c)return c.call(a,Array.prototype.slice.call(arguments,2));if("undefined"!=typeof c)return c}}var h=a("plain-merge"),i=a("pouchdb/extras/promise"),j=(a("pouchdb/lib/deps/errors"),b.exports=function(a){return{lazybones:function(b){var c=this;return function(d,e,f){return f=h.defaults({},f,b,a,{database:c}),j.sync.call(this,d,e,f)}}}}),k={create:"post",update:"put",patch:"put","delete":"remove"};j.defaults={success:d,error:d,changes:!1,query:null,rowKey:"doc",options:{get:{},query:{include_docs:!0,returnDocs:!1},allDocs:{include_docs:!0},changes:{returnDocs:!1}},fetch:function(a,b,c){return l(a)?c.query?b.query(c.query,c.options.query):b.allDocs(c.options.allDocs):b.get(a.id,c.options.get)},process:function(a,b,c,d){if(null==a._id&&null==a._rev){if("read"!==b)return{_id:a.id,_rev:a.rev};if(null!=a.rows)return l(c)?a.rows.map(function(a){return a[d.rowKey]}):a.rows.length?a.rows[0][d.rowKey]:null;if(null!=a[d.rowKey])return a[d.rowKey]}return a}},j.sync=function(a,b,c){var d,g,m,n,o,p;if(d=this,c=h.defaults({},c,e(b),e(b.collection),j.defaults),a=a.toLowerCase().trim(),g=f(c)||f(b),null==g)throw new Error("Missing PouchDB database.");if("read"!==a)n=g[k[a]](b.toJSON(),c.options[k[a]]);else{if(c.changes)return o=h.defaults({include_docs:!0},c.changes,c.options.changes),"function"==typeof o.filter&&(p=o.filter,o.filter=null),n=g.changes(o),m=function(e){var f=c.process.call(d,e,a,b,c);(!p||p(f,e,c))&&b.set(f,h.extend({remove:!1},c))},n.on("create",m),n.on("update",m),n.on("delete",function(e){var f=l(b)?b.remove(e.id,c):b;if(f){var g=c.process.call(d,e,a,b,c);f.set(g,c)}}),n;n=c.fetch.call(d,b,g,c),(null==n||"function"!=typeof n.then)&&(n=i.resolve(n))}return b.trigger("request",b,g,c),n.then(function(e){return c.success(c.process.call(d,e,a,b,c)),e})["catch"](function(a){throw c.error(a),a})};var l=j.isCollection=function(a){return null!=a&&Array.isArray(a.models)&&"function"==typeof a.model&&"function"==typeof a.add&&"function"==typeof a.remove};j.isModel=function(a){return null!=a&&"string"==typeof a.cid&&"object"==typeof a.attributes&&"function"==typeof a.get&&"function"==typeof a.set}},{"plain-merge":3,"pouchdb/extras/promise":6,"pouchdb/lib/deps/errors":7}],2:[function(a,b,c){},{}],3:[function(a,b,c){function d(a,b){for(var c=g.call(arguments,2),d=0;d<c.length;d++)b=h(b,c[d],a);return b}var e=a("is-plain-object"),f=Object.prototype.hasOwnProperty,g=Array.prototype.slice,h=b.exports=function(a,b,c){if(e(a)&&e(b)){for(var d in b)f.call(b,d)&&(a[d]=h(a[d],b[d],c));return a}return c&&"undefined"!=typeof a?a:b};h.extend=d.bind(null,!1),h.defaults=d.bind(null,!0)},{"is-plain-object":4}],4:[function(a,b,c){"use strict";function d(a){return e(a)===!0&&"[object Object]"===Object.prototype.toString.call(a)}var e=a("isobject");b.exports=function(a){var b,c;return d(a)===!1?!1:(b=a.constructor,"function"!=typeof b?!1:(c=b.prototype,d(c)===!1?!1:c.hasOwnProperty("isPrototypeOf")===!1?!1:!0))}},{isobject:5}],5:[function(a,b,c){"use strict";b.exports=function(a){return null!=a&&"object"==typeof a&&!Array.isArray(a)}},{}],6:[function(a,b,c){"use strict";b.exports=a("../lib/deps/promise")},{"../lib/deps/promise":8}],7:[function(a,b,c){"use strict";function d(a){Error.call(a.reason),this.status=a.status,this.name=a.error,this.message=a.reason,this.error=!0}var e=a("inherits");e(d,Error),d.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},c.UNAUTHORIZED=new d({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),c.MISSING_BULK_DOCS=new d({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),c.MISSING_DOC=new d({status:404,error:"not_found",reason:"missing"}),c.REV_CONFLICT=new d({status:409,error:"conflict",reason:"Document update conflict"}),c.INVALID_ID=new d({status:400,error:"invalid_id",reason:"_id field must contain a string"}),c.MISSING_ID=new d({status:412,error:"missing_id",reason:"_id is required for puts"}),c.RESERVED_ID=new d({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),c.NOT_OPEN=new d({status:412,error:"precondition_failed",reason:"Database not open"}),c.UNKNOWN_ERROR=new d({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),c.BAD_ARG=new d({status:500,error:"badarg",reason:"Some query argument is invalid"}),c.INVALID_REQUEST=new d({status:400,error:"invalid_request",reason:"Request was invalid"}),c.QUERY_PARSE_ERROR=new d({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),c.DOC_VALIDATION=new d({status:500,error:"doc_validation",reason:"Bad special document member"}),c.BAD_REQUEST=new d({status:400,error:"bad_request",reason:"Something wrong with the request"}),c.NOT_AN_OBJECT=new d({status:400,error:"bad_request",reason:"Document must be a JSON object"}),c.DB_MISSING=new d({status:404,error:"not_found",reason:"Database not found"}),c.IDB_ERROR=new d({status:500,error:"indexed_db_went_bad",reason:"unknown"}),c.WSQ_ERROR=new d({status:500,error:"web_sql_went_bad",reason:"unknown"}),c.LDB_ERROR=new d({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),c.FORBIDDEN=new d({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),c.INVALID_REV=new d({status:400,error:"bad_request",reason:"Invalid rev format"}),c.FILE_EXISTS=new d({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),c.MISSING_STUB=new d({status:412,error:"missing_stub"}),c.error=function(a,b,c){function e(b){for(var d in a)"function"!=typeof a[d]&&(this[d]=a[d]);void 0!==c&&(this.name=c),void 0!==b&&(this.reason=b)}return e.prototype=d.prototype,new e(b)},c.getErrorTypeByProp=function(a,b,d){var e=c,f=Object.keys(e).filter(function(c){var d=e[c];return"function"!=typeof d&&d[a]===b}),g=d&&f.filter(function(a){var b=e[a];return b.message===d})[0]||f[0];return g?e[g]:null},c.generateErrorFromResponse=function(a){var b,d,e,f,g,h=c;return d=a.error===!0&&"string"==typeof a.name?a.name:a.error,g=a.reason,e=h.getErrorTypeByProp("name",d,g),a.missing||"missing"===g||"deleted"===g||"not_found"===d?e=h.MISSING_DOC:"doc_validation"===d?(e=h.DOC_VALIDATION,f=g):"bad_request"===d&&e.message!==g&&(0===g.indexOf("unknown stub attachment")?(e=h.MISSING_STUB,f=g):e=h.BAD_REQUEST),e||(e=h.getErrorTypeByProp("status",a.status,g)||h.UNKNOWN_ERROR),b=h.error(e,g,d),f&&(b.message=f),a.id&&(b.id=a.id),a.status&&(b.status=a.status),a.statusText&&(b.name=a.statusText),a.missing&&(b.missing=a.missing),b}},{inherits:9}],8:[function(a,b,c){"use strict";"function"==typeof Promise?b.exports=Promise:b.exports=a("bluebird")},{bluebird:13}],9:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],10:[function(a,b,c){"use strict";function d(){}b.exports=d},{}],11:[function(a,b,c){"use strict";function d(a){function b(a,b){function e(a){j[b]=a,++k===c&!d&&(d=!0,i.resolve(m,j))}g(a).then(e,function(a){d||(d=!0,i.reject(m,a))})}if("[object Array]"!==Object.prototype.toString.call(a))return f(new TypeError("must be an array"));var c=a.length,d=!1;if(!c)return g([]);for(var j=new Array(c),k=0,l=-1,m=new e(h);++l<c;)b(a[l],l);return m}var e=a("./promise"),f=a("./reject"),g=a("./resolve"),h=a("./INTERNAL"),i=a("./handlers");b.exports=d},{"./INTERNAL":10,"./handlers":12,"./promise":14,"./reject":17,"./resolve":18}],12:[function(a,b,c){"use strict";function d(a){var b=a&&a.then;return a&&"object"==typeof a&&"function"==typeof b?function(){b.apply(a,arguments)}:void 0}var e=a("./tryCatch"),f=a("./resolveThenable"),g=a("./states");c.resolve=function(a,b){var h=e(d,b);if("error"===h.status)return c.reject(a,h.value);var i=h.value;if(i)f.safely(a,i);else{a.state=g.FULFILLED,a.outcome=b;for(var j=-1,k=a.queue.length;++j<k;)a.queue[j].callFulfilled(b)}return a},c.reject=function(a,b){a.state=g.REJECTED,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a}},{"./resolveThenable":19,"./states":20,"./tryCatch":21}],13:[function(a,b,c){b.exports=c=a("./promise"),c.resolve=a("./resolve"),c.reject=a("./reject"),c.all=a("./all"),c.race=a("./race")},{"./all":11,"./promise":14,"./race":16,"./reject":17,"./resolve":18}],14:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=h.PENDING,this.queue=[],this.outcome=void 0,a!==f&&g.safely(this,a)}var e=a("./unwrap"),f=a("./INTERNAL"),g=a("./resolveThenable"),h=a("./states"),i=a("./queueItem");b.exports=d,d.prototype["catch"]=function(a){return this.then(null,a)},d.prototype.then=function(a,b){if("function"!=typeof a&&this.state===h.FULFILLED||"function"!=typeof b&&this.state===h.REJECTED)return this;var c=new d(f);if(this.state!==h.PENDING){var g=this.state===h.FULFILLED?a:b;e(c,g,this.outcome)}else this.queue.push(new i(c,a,b));return c}},{"./INTERNAL":10,"./queueItem":15,"./resolveThenable":19,"./states":20,"./unwrap":22}],15:[function(a,b,c){"use strict";function d(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}var e=a("./handlers"),f=a("./unwrap");b.exports=d,d.prototype.callFulfilled=function(a){e.resolve(this.promise,a)},d.prototype.otherCallFulfilled=function(a){f(this.promise,this.onFulfilled,a)},d.prototype.callRejected=function(a){e.reject(this.promise,a)},d.prototype.otherCallRejected=function(a){f(this.promise,this.onRejected,a)}},{"./handlers":12,"./unwrap":22}],16:[function(a,b,c){"use strict";function d(a){function b(a){g(a).then(function(a){d||(d=!0,i.resolve(k,a))},function(a){d||(d=!0,i.reject(k,a))})}if("[object Array]"!==Object.prototype.toString.call(a))return f(new TypeError("must be an array"));var c=a.length,d=!1;if(!c)return g([]);for(var j=-1,k=new e(h);++j<c;)b(a[j]);return k}var e=a("./promise"),f=a("./reject"),g=a("./resolve"),h=a("./INTERNAL"),i=a("./handlers");b.exports=d},{"./INTERNAL":10,"./handlers":12,"./promise":14,"./reject":17,"./resolve":18}],17:[function(a,b,c){"use strict";function d(a){var b=new e(f);return g.reject(b,a)}var e=a("./promise"),f=a("./INTERNAL"),g=a("./handlers");b.exports=d},{"./INTERNAL":10,"./handlers":12,"./promise":14}],18:[function(a,b,c){"use strict";function d(a){if(a)return a instanceof e?a:g.resolve(new e(f),a);var b=typeof a;switch(b){case"boolean":return h;case"undefined":return j;case"object":return i;case"number":return k;case"string":return l}}var e=a("./promise"),f=a("./INTERNAL"),g=a("./handlers");b.exports=d;var h=g.resolve(new e(f),!1),i=g.resolve(new e(f),null),j=g.resolve(new e(f),void 0),k=g.resolve(new e(f),0),l=g.resolve(new e(f),"")},{"./INTERNAL":10,"./handlers":12,"./promise":14}],19:[function(a,b,c){"use strict";function d(a,b){function c(b){h||(h=!0,e.reject(a,b))}function d(b){h||(h=!0,e.resolve(a,b))}function g(){b(d,c)}var h=!1,i=f(g);"error"===i.status&&c(i.value)}var e=a("./handlers"),f=a("./tryCatch");c.safely=d},{"./handlers":12,"./tryCatch":21}],20:[function(a,b,c){c.REJECTED=["REJECTED"],c.FULFILLED=["FULFILLED"],c.PENDING=["PENDING"]},{}],21:[function(a,b,c){"use strict";function d(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}b.exports=d},{}],22:[function(a,b,c){"use strict";function d(a,b,c){e(function(){var d;try{d=b(c)}catch(e){return f.reject(a,e)}d===a?f.reject(a,new TypeError("Cannot resolve promise with itself")):f.resolve(a,d)})}var e=a("immediate"),f=a("./handlers");b.exports=d},{"./handlers":12,immediate:23}],23:[function(a,b,c){"use strict";function d(){f=!0;for(var a,b,c=i.length;c;){for(b=i,i=[],a=-1;++a<c;)b[a]();c=i.length}f=!1}function e(a){1!==i.push(a)||f||g()}for(var f,g,h=[a("./nextTick"),a("./mutation.js"),a("./messageChannel"),a("./stateChange"),a("./timeout")],i=[],j=-1,k=h.length;++j<k;)if(h[j]&&h[j].test&&h[j].test()){g=h[j].install(d);break}b.exports=e},{"./messageChannel":24,"./mutation.js":25,"./nextTick":2,"./stateChange":26,"./timeout":27}],24:[function(a,b,c){(function(a){"use strict";c.test=function(){return a.setImmediate?!1:"undefined"!=typeof a.MessageChannel},c.install=function(b){var c=new a.MessageChannel;return c.port1.onmessage=b,function(){c.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(a,b,c){(function(a){"use strict";var b=a.MutationObserver||a.WebKitMutationObserver;c.test=function(){return b},c.install=function(c){var d=0,e=new b(c),f=a.document.createTextNode("");return e.observe(f,{characterData:!0}),function(){f.data=d=++d%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],26:[function(a,b,c){(function(a){"use strict";c.test=function(){return"document"in a&&"onreadystatechange"in a.document.createElement("script")},c.install=function(b){return function(){var c=a.document.createElement("script");return c.onreadystatechange=function(){b(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},a.document.documentElement.appendChild(c),b}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(a,b,c){"use strict";c.test=function(){return!0},c.install=function(a){return function(){setTimeout(a,0)}}},{}]},{},[1])(1)});